<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
    "http://www.w3.org/TR/html4/strict.dtd">
<html ="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Greg Detre</title>
    <meta name="description" content="greg detre gregdetre memrise princeton mvpa" />
    
          <link rel="stylesheet" type="text/css" charset="utf-8" href="/media/main.css" />
        
        
    
      <link rel="icon" 
            type="image/png" 
            href="/img/favicon.png">

      <script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-20347856-5']);
  _gaq.push(['_setDomainName', 'gregdetre.co.uk']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>  </head>
  
    <body class="">
        
    <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
  <head>
    <title>
      Greg Detre - tech
    </title>
    <meta name="generator" content="muse.el">
    <meta http-equiv="Content-Type"
          content="text/html; charset=iso-8859-1">

<p><link rel="stylesheet" type="text/css" charset="utf-8" media="all" href="common.css" />
<link rel="stylesheet" type="text/css" charset="utf-8" media="screen" href="screen.css" />
<link rel="stylesheet" type="text/css" charset="utf-8" media="print" href="print.css" /></p>
<p></head>
  <body></p>
<pre><code>&lt;!-- Page published by Emacs Muse begins here --&gt;
</code></pre>
<p><h2><a name="sec1" id="sec1"></a>
Technical overview of the Freex source&nbsp;code</h2></p>
<dl class="contents">
<dt class="contents">
<a href="#sec1">Technical overview of the Freex source&nbsp;code</a>
</dt>
<dd>
<dl class="contents">
<dt class="contents">
<a href="#sec2">Introduction</a>
</dt>
<dt class="contents">
<a href="#sec3">freex-conf-test.el</a>
</dt>
<dt class="contents">
<a href="#sec4">freex-mode.el</a>
</dt>
<dt class="contents">
<a href="#sec5">freex-embed.el</a>
</dt>
<dt class="contents">
<a href="#sec6">freex-fontify.el</a>
</dt>
<dt class="contents">
<a href="#sec7">freex-xml.el</a>
</dt>
<dt class="contents">
<a href="#sec8">freex-meta.el</a>
</dt>
<dt class="contents">
<a href="#sec9">freex_sqlalchemy.py</a>
</dt>
<dt class="contents">
<a href="#sec10">freex-timestamp.el</a>
</dt>
<dt class="contents">
<a href="#sec11">freex_sqlalchemy_test.py</a>
</dt>
<dt class="contents">
<a href="#sec12">run_tests</a>
</dt>
<dt class="contents">
<a href="#sec13">freex.el</a>
</dt>
<dt class="contents">
<a href="#sec14">Acknowledgments</a>
</dt>
</dl>
</dd>
</dl>

<h3><a name="sec2" id="sec2"></a>&nbsp;Introduction</h3>

<p class="first">If you&#8217;re interested in hacking the Freex source code, this
is a high-level guide for what&#8217;s what. It assumes that you
already have things working (see <a href="install.html">install</a>).</p>

<p>The main thorny bits of code relate&nbsp;to:</p>

<ul>
<li>Interfacing with Pymacs to freex_sqlalchemy.py, to access
all the metadata stuff stored in the sqlite&nbsp;database</li>
<li>Using Emacs&#8217; overlays functionality to allow embedded
nuggets within nuggets, and also to view and edit&nbsp;metadata</li>
<li>Automatically creating implicit links to any text that
matches a regex (containing all the nugget aliases in
your&nbsp;database)</li>
</ul>

<p>Freex is a minor mode. However, the embedding stuff requires
us to override the standard saving mechanism, which can make
interfacing with the major mode complicated in some&nbsp;cases.</p>

<h3><a name="sec3" id="sec3"></a>&nbsp;freex-conf-test.el</h3>

<p class="first">This is the sample configuration file, requiring only a few changes to
get you up and running. It&#8217;ll give you an idea of the main variables
to change if you want to play with Freex&#8217;s major&nbsp;functionality.</p>

<h3><a name="sec4" id="sec4"></a>&nbsp;freex-mode.el</h3>

<p class="first">This defines all the initialization and clenaup for the Freex minor
mode,&nbsp;including:</p>

<ul>
<li>Checking that the current file is in the freex data&nbsp;directory</li>
<li>Setting up basic hooks, default variables and&nbsp;keybindings</li>
<li>Adding the buffer-local variables that the buffer needs in
order to know how to save itself to the&nbsp;database</li>
<li>Initializing&nbsp;fontification</li>
</ul>

<h3><a name="sec5" id="sec5"></a>&nbsp;freex-embed.el</h3>

<p class="first">Provides the mechanisms for embedding nuggets within other nuggets,
using Emacs overlays. This also includes the Freex-specific save
mechanism, which handles saving embedded overlays, and mirroring the
contents to the&nbsp;database.</p>

<h4>Embedding</h4>

<p class="first">If you want to embed a nugget or some
metadata, then you include an xml element, such&nbsp;as:</p>

<pre class="example">
&lt;file&gt;blah.freex&lt;/file&gt;
</pre>

<p>and then run freex-embed-buffer. That calls on freex-xml.el to go
through the buffer, looks for such xml&nbsp;elements,</p>

<p>The process of embedding a nugget replaces the
<pre class="example">&lt;file&gt;...&lt;/file&gt;</pre> xml element, with an overlay
containing the contents of the file specified. Importantly, every
freex overlay contains various properties, such&nbsp;as:</p>

<ul>
<li><span class="quo">&#8216;</span>id&#8217; relates to the nugget id field in the&nbsp;database</li>
<li><span class="quo">&#8216;</span>insert-funct&#8217; tells the overlay which function to use to get its
contents&nbsp;from</li>
<li><span class="quo">&#8216;</span>save-funct&#8217; tells the overlay which function to call at save to
store its&nbsp;contents</li>
</ul>

<p>In this way, you can easily create new xml elements, and by specifying
an insert-funct and save-funct, you can make them do anything you&nbsp;like.</p>

<p>Notably, freex buffers themselves have a buffer-local
&#8216;freex-embed-ov-props&#8217; variable, so that the buffer knows which nugget
in the database it relates&nbsp;to.</p>

<h3><a name="sec6" id="sec6"></a>&nbsp;freex-fontify.el</h3>

<p class="first">Provides all the font-lock mechanisms for going through your buffer,
looking for xml elements and implicit links with various complicated
regexes. The implicit link regular expression can get pretty huge,
because it&#8217;s basically a big chain of disjunctions including every
alias in your database. If you have lots of nuggets, this can bring
Emacs&#8217; regex engine to its knees, and so we actually run the regex in&nbsp;python.</p>

<h3><a name="sec7" id="sec7"></a>&nbsp;freex-xml.el</h3>

<p class="first">Convenience functions for dealing with xml&nbsp;elements.</p>

<h3><a name="sec8" id="sec8"></a>&nbsp;freex-meta.el</h3>

<p class="first">This is the main gateway between Emacs and the database, via&nbsp;freex_sqlalchemy:</p>

<ul>
<li>Connects to the&nbsp;database</li>
<li>Sets various variables (e.g. location of freex data&nbsp;directory)</li>
<li>Deals with embedded metadata&nbsp;overlays</li>
<li>Defines various elements (e.g. tag-parents/children,&nbsp;aliases)</li>
<li>Updates database when the filesystem&nbsp;changes</li>
<li>Freex file finding and tab&nbsp;completion</li>
</ul>

<h3><a name="sec9" id="sec9"></a>&nbsp;freex_sqlalchemy.py</h3>

<p class="first">This contains all the python code for interacting with the&nbsp;databse:</p>

<ul>
<li>initializing a new&nbsp;database</li>
<li>adding, removing and modifying&nbsp;nuggets</li>
<li>querying</li>
</ul>

<h3><a name="sec10" id="sec10"></a>&nbsp;freex-timestamp.el</h3>

<p class="first">This updates the database with a timestamp every time a freex nugget
is&nbsp;modified.</p>

<h3><a name="sec11" id="sec11"></a>&nbsp;freex_sqlalchemy_test.py</h3>

<p class="first">Lots of unit tests for all the python database&nbsp;functions.</p>

<h3><a name="sec12" id="sec12"></a>&nbsp;run_tests</h3>

<p class="first">Handy alias for running the python unit&nbsp;tests.</p>

<h3><a name="sec13" id="sec13"></a>&nbsp;freex.el</h3>

<p class="first">A few utility&nbsp;functions</p>

<h3><a name="sec14" id="sec14"></a>&nbsp;Acknowledgments</h3>

<p class="first">We want to thank the Muse developers, since huge chunks of their code
provided inspiration and foundation for the Freex fontification and
xml&nbsp;parsing.</p>

<!-- Page published by Emacs Muse ends here -->

<hr>

<script language="javascript" src="footer.js">

  </body>
</html>
          <br>
<hr>

<h6>
  <p align="center">
    <a href="http://blog.gregdetre.co.uk/">Home</a> - 
    <a href="http://blog.gregdetre.co.uk/posts/">Blog</a> - 
    <a href="http://blog.gregdetre.co.uk/startups/">Startups</a> - 
    <a href="http://blog.gregdetre.co.uk/software/">Software</a> - 
    <a href="http://blog.gregdetre.co.uk/research/">Research</a> - 
    <a href="http://blog.gregdetre.co.uk/writing/">Writing</a>
  </p>

  <p align="center">
    <a href="mailto:greg@gregdetre.co.uk">Email me</a> - updated 31 Dec 2012
  </p>

</h6>
    
              
    
             

  </body>
</html>
